<link rel="stylesheet" href="/assets/css/terminal.css">

<!-- Background Canvas for Math Animation -->
<canvas id="math-canvas" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; background-color: #050505;"></canvas>

<!-- Terminal Container (Overlay) -->
<div id="terminal-container" class="terminal-container" style="position: relative; z-index: 1; background-color: rgba(0, 0, 0, 0.65); border: 1px solid #33ff00; height: 70vh; margin-top: 5vh;">
  <div id="terminal-output"></div>
  <div id="terminal-input-line" style="display: none; display: flex; align-items: center;">
    <span class="terminal-prompt">whoami@huijo.xyz:~$</span>
    <input type="text" id="terminal-input" class="terminal-input" autocomplete="off" spellcheck="false">
  </div>
  <div id="terminal-search-results"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // --- 1. Lorenz Attractor Animation ---
  const canvas = document.getElementById('math-canvas');
  const ctx = canvas.getContext('2d');
  
  let width, height;
  
  function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
    ctx.fillStyle = '#050505';
    ctx.fillRect(0, 0, width, height);
  }
  
  window.addEventListener('resize', resize);
  resize();

  // Lorenz System Parameters
  let x = 0.1, y = 0, z = 0;
  const sigma = 10;
  const rho = 28;
  const beta = 8/3;
  const dt = 0.01;
  
  function drawLorenz() {
    ctx.beginPath();
    ctx.strokeStyle = `rgba(0, 255, 100, 0.4)`; // Matrix green, semi-transparent
    ctx.lineWidth = 0.8;
    
    // Draw multiple steps per frame for speed
    for (let i = 0; i < 20; i++) {
      ctx.moveTo(width/2 + x * 15, height/2 + z * 10 - 200); // Scale and center
      
      const dx = sigma * (y - x) * dt;
      const dy = (x * (rho - z) - y) * dt;
      const dz = (x * y - beta * z) * dt;
      
      x += dx;
      y += dy;
      z += dz;
      
      ctx.lineTo(width/2 + x * 15, height/2 + z * 10 - 200);
    }
    
    ctx.stroke();
    
    // Fade effect
    ctx.fillStyle = 'rgba(5, 5, 5, 0.01)';
    ctx.fillRect(0, 0, width, height);
    
    requestAnimationFrame(drawLorenz);
  }
  
  drawLorenz();


  // --- 2. Terminal Boot & Logic ---
  const outputDiv = document.getElementById('terminal-output');
  const inputLine = document.getElementById('terminal-input-line');
  const inputField = document.getElementById('terminal-input');
  const resultsDiv = document.getElementById('terminal-search-results');

  const bootText = [
    "Initializing Kernel...",
    "Verifying Euler's Identity: e^(iπ) + 1 = 0 ... [Verified]",
    "----------------------------------------------------------------",
    "To be uncertain is to be uncomfortable,",
    "but to be certain is to be ridiculous.",
    "                                          — Goethe",
    "----------------------------------------------------------------",
    "System Ready.",
    "Enter query to search database."

  ];

  let lineIndex = 0;
  let charIndex = 0;
  const typeSpeed = 20; 
  const linePause = 150;

  // Bio Text Data
  const bioContent = `
<div style="margin-top: 10px; margin-bottom: 20px;">
  <div style="color: #fff; font-weight: bold; border-bottom: 1px dashed #33ff00; padding-bottom: 5px; margin-bottom: 10px;">Author's Bio</div>
  <p>I am a machine learning practitioner and former founder working across predictive modeling, computer vision, MLOps, and autonomous systems. After studying mechanical engineering, I worked in the electric vehicle development sector at <strong>Hyundai Motor Group</strong>, contributing to large-scale, safety-critical automotive systems.</p>
  <p>I later founded and scaled an <a href="http://hexafarms.com"><strong>agtech startup</strong></a> from zero to a six-figure ARR business. This experience shaped my focus on building technology that delivers measurable, real-world value rather than chasing technical hype. After exiting, I transitioned into the <strong>e-commerce domain</strong>, applying machine learning to large-scale experimentation and operational optimization.</p>
  <p>My background includes graduate research in robotics, published work in applied machine learning, and hands-on experience deploying end-to-end ML systems. I am particularly interested in explainability-driven optimization, agent-based workflows, and cross-disciplinary system design. I believe polymath practitioners—those who can bridge domains—will be especially valuable in the era of AI.</p>
</div>
`;

  function typeWriter() {
    if (lineIndex < bootText.length) {
      if (charIndex === 0) {
        const p = document.createElement('div');
        p.className = 'terminal-line';
        outputDiv.appendChild(p);
      }
      
      const currentLine = bootText[lineIndex];
      const currentP = outputDiv.lastElementChild;
      
      if (charIndex < currentLine.length) {
        currentP.textContent += currentLine.charAt(charIndex);
        charIndex++;
        setTimeout(typeWriter, typeSpeed);
      } else {
        lineIndex++;
        charIndex = 0;
        setTimeout(typeWriter, linePause);
      }
    } else {
      inputLine.style.display = 'flex';
      inputField.focus();
      
      // Check for commands
      const urlParams = new URLSearchParams(window.location.search);
      const cmd = urlParams.get('cmd');
      if (cmd === 'cat_bio') {
        const cmdLine = document.createElement('div');
        cmdLine.className = 'terminal-line';
        cmdLine.innerHTML = '<span class="terminal-prompt">whoami@huijo.xyz:~$</span> cat bio.txt';
        outputDiv.appendChild(cmdLine);
        
        const resultDiv = document.createElement('div');
        resultDiv.className = 'terminal-line';
        resultDiv.innerHTML = bioContent;
        outputDiv.appendChild(resultDiv);
        
        // Clean up URL
        window.history.replaceState({}, document.title, "/");
      }
    }
  }

  typeWriter();

  document.getElementById('terminal-container').addEventListener('click', function() {
    if (inputLine.style.display !== 'none') inputField.focus();
  });

  inputField.addEventListener('keyup', function(e) {
    const query = this.value.toLowerCase();
    resultsDiv.innerHTML = '';

    if (query.length === 0) return;
    
    // Easter Egg: Math Eval
    if (query.startsWith("eval ")) {
       try {
         const expr = query.substring(5);
         // Safety: minimal evaluator or just basic JS math
         const res = eval(expr); // Warning: eval is dangerous in open web, but static site input is local.
         resultsDiv.innerHTML = `<div class="terminal-line">> Result: ${res}</div>`;
         return;
       } catch (err) {
         resultsDiv.innerHTML = `<div class="terminal-line" style="color:red;">> Error: ${err.message}</div>`;
         return;
       }
    }

    if (typeof idx === 'undefined' || typeof store === 'undefined') {
      resultsDiv.innerHTML = '<div class="terminal-line" style="color:red;">Error: Index loading...</div>';
      return;
    }

    const result = idx.query(function (q) {
      query.split(lunr.tokenizer.separator).forEach(function (term) {
        q.term(term, { boost: 100 })
        if(query.lastIndexOf(" ") != query.length-1){
          q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
        }
        if (term != ""){
          q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
        }
      })
    });

    if (result.length > 0) {
       resultsDiv.innerHTML = `<div class="terminal-line">> Found ${result.length} result(s):</div>`;
       const limit = Math.min(result.length, 8);
       
       for (let i = 0; i < limit; i++) {
         const item = result[i];
         const doc = store[item.ref];
         const resultItem = document.createElement('div');
         resultItem.className = 'search-result-item';
         resultItem.innerHTML = `[${doc.categories || 'File'}] <a href="${doc.url}">${doc.title}</a>`;
         resultsDiv.appendChild(resultItem);
       }
    } else {
      resultsDiv.innerHTML = '<div class="terminal-line">> No results found.</div>';
    }
  });
});
</script>